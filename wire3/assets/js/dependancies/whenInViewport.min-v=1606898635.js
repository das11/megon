!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.WhenInViewport=t()}(this,function(){var e,t;function n(e,t,n){l.setup(),this.registryItem=u.addItem(e,"function"==typeof t?c(n||{},{callback:t}):t),u.processItem(this.registryItem)}function i(){return"innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight}function r(){return"pageYOffset"in window?window.pageYOffset:document.documentElement.scrollTop||document.body.scrollTop}function o(e){return e.getBoundingClientRect().top+r()}function s(e,t,n){for(var i in e)if(e.hasOwnProperty(i)&&!1===t.call(n,e[i],i))break}function c(e){for(var t=1;t<arguments.length;t++)s(arguments[t],function(t,n){e[n]=t});return e}n.prototype.stopListening=function(){u.removeItem(this.registryItem),l.removeIfStoreEmpty()},n.defaults={threshold:0,context:null},c(n,{setRateLimiter:function(e,t){return l.rateLimiter=e,t&&(l.rateLimitDelay=t),this},checkAll:function(){return t=r(),e=i(),u.adjustPositions(u.processItem),l.removeIfStoreEmpty(),this},destroy:function(){return u.store={},l.remove(),delete l.scrollHandler,delete l.resizeHandler,this},registerAsJqueryPlugin:function(e){return e.fn.whenInViewport=function(t,i){var r,o=function(t){return function(n){t.call(this,e(n))}};return r="function"==typeof t?e.extend({},i,{callback:o(t)}):e.extend(t,{callback:o(t.callback)}),this.each(function(){r.setupOnce?!e.data(this,"whenInViewport")&&e.data(this,"whenInViewport",new n(this,r)):e.data(this,"whenInViewport",new n(this,r))})},this}});var u={store:{},counter:0,addItem:function(e,t){var i="whenInViewport"+ ++this.counter,r=c({},n.defaults,t,{storeKey:i,element:e,topOffset:o(e)});return this.store[i]=r},adjustPositions:function(e){s(this.store,function(t){t.topOffset=o(t.element),e&&e.call(u,t)})},processAll:function(){s(this.store,this.processItem,this)},processItem:function(n){t+e>=n.topOffset-n.threshold&&(this.removeItem(n),n.callback.call(n.context||window,n.element))},removeItem:function(e){delete this.store[e.storeKey]},isEmpty:function(){var e=!0;return s(this.store,function(){return e=!1}),e}},l={setuped:!1,rateLimiter:function(e,t){return e},rateLimitDelay:100,on:function(e,t){return window.addEventListener?window.addEventListener(e,t,!1):window.attachEvent&&window.attachEvent(e,t),this},off:function(e,t){return window.removeEventListener?window.removeEventListener(e,t,!1):window.detachEvent&&window.detachEvent("on"+e,t),this},setup:function(){var n=this;this.setuped||(t=r(),e=i(),this.scrollHandler=this.scrollHandler||this.rateLimiter(function(){t=r(),u.processAll(),n.removeIfStoreEmpty()},this.rateLimitDelay),this.resizeHandler=this.resizeHandler||this.rateLimiter(function(){e=i(),u.adjustPositions(u.processItem),n.removeIfStoreEmpty()},this.rateLimitDelay),this.on("scroll",this.scrollHandler).on("resize",this.resizeHandler),this.setuped=!0)},removeIfStoreEmpty:function(){u.isEmpty()&&this.remove()},remove:function(){this.setuped&&(this.off("scroll",this.scrollHandler).off("resize",this.resizeHandler),this.setuped=!1)}},f=window.jQuery||window.$;return f&&n.registerAsJqueryPlugin(f),n});